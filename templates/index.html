{% extends "base.html" %}
{% block title %}UzzerStore - Moda com Estilo{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <h1 class="hero-title">Busque sua inspira√ß√£o de visual</h1>
    <p class="hero-subtitle">Descubra as √∫ltimas tend√™ncias em moda</p>
</section>

<!-- Filter Section -->
<section class="filter-section">
    <div class="filter-left">
        <button class="filter-toggle" onclick="toggleFilters()">
            <i class="fas fa-sliders-h"></i> Mostrar filtros
        </button>
        <span class="product-count">{{ produtos|length }} produto{{ 's' if produtos|length != 1 else '' }}</span>
    </div>
    <div class="filter-right">
        <label class="sort-label">Ordenar por:</label>
        <select class="sort-dropdown" onchange="sortProducts(this.value)">
            <option value="destaque">Em destaque</option>
            <option value="menor-preco">Menor pre√ßo</option>
            <option value="maior-preco">Maior pre√ßo</option>
            <option value="nome-az">Nome A-Z</option>
            <option value="nome-za">Nome Z-A</option>
            <option value="mais-novos">Mais novos</option>
        </select>
    </div>
</section>

<!-- Panel de Filtros -->
<div class="filters-panel" id="filters-panel">
    <div class="filters-container">
        <div class="filters-header">
            <h3>üîç Filtros</h3>
            <button class="close-filters" onclick="toggleFilters()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="filters-content">
            <!-- Filtro por Categoria -->
            <div class="filter-group">
                <h4>Categoria</h4>
                <div class="filter-options">
                    <label class="filter-option">
                        <input type="checkbox" value="" onchange="filterProducts()" checked>
                        <span class="checkmark"></span>
                        Todas as categorias
                    </label>
                    {% for categoria in categorias %}
                    <label class="filter-option">
                        <input type="checkbox" value="{{ categoria.categoria }}" onchange="filterProducts()">
                        <span class="checkmark"></span>
                        {{ categoria.categoria }}
                    </label>
                    {% endfor %}
                </div>
            </div>

            <!-- Filtro por Pre√ßo -->
            <div class="filter-group">
                <h4>Faixa de Pre√ßo</h4>
                <div class="price-range">
                    <div class="price-inputs">
                        <div>
                            <label>M√≠n:</label>
                            <input type="number" id="min-price" placeholder="0" min="0" onchange="filterProducts()">
                        </div>
                        <div>
                            <label>M√°x:</label>
                            <input type="number" id="max-price" placeholder="1000" min="0" onchange="filterProducts()">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filtro por Tamanho -->
            <div class="filter-group">
                <h4>Tamanho</h4>
                <div class="size-options">
                    <label class="size-option">
                        <input type="checkbox" value="" onchange="filterProducts()" checked>
                        <span class="size-checkmark">Todos</span>
                    </label>
                    <label class="size-option">
                        <input type="checkbox" value="PP" onchange="filterProducts()">
                        <span class="size-checkmark">PP</span>
                    </label>
                    <label class="size-option">
                        <input type="checkbox" value="P" onchange="filterProducts()">
                        <span class="size-checkmark">P</span>
                    </label>
                    <label class="size-option">
                        <input type="checkbox" value="M" onchange="filterProducts()">
                        <span class="size-checkmark">M</span>
                    </label>
                    <label class="size-option">
                        <input type="checkbox" value="G" onchange="filterProducts()">
                        <span class="size-checkmark">G</span>
                    </label>
                    <label class="size-option">
                        <input type="checkbox" value="GG" onchange="filterProducts()">
                        <span class="size-checkmark">GG</span>
                    </label>
                    <label class="size-option">
                        <input type="checkbox" value="XG" onchange="filterProducts()">
                        <span class="size-checkmark">XG</span>
                    </label>
                </div>
            </div>

            <!-- Filtros R√°pidos -->
            <div class="filter-group">
                <h4>Filtros R√°pidos</h4>
                <div class="quick-filters">
                    <button class="quick-filter" onclick="setQuickFilter('promocao')">
                        üè∑Ô∏è Promo√ß√£o
                    </button>
                    <button class="quick-filter" onclick="setQuickFilter('lancamento')">
                        ‚≠ê Lan√ßamentos
                    </button>
                    <button class="quick-filter" onclick="setQuickFilter('mais-vendidos')">
                        üî• Mais Vendidos
                    </button>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="filter-actions">
                <button class="btn-clear-filters" onclick="clearAllFilters()">
                    üóëÔ∏è Limpar Filtros
                </button>
                <button class="btn-apply-filters" onclick="toggleFilters()">
                    ‚úÖ Aplicar Filtros
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Products Section -->
<section class="products-container">
    <div class="products-header">
        <div class="active-filters" id="active-filters" style="display: none;">
            <span class="active-filters-label">Filtros ativos:</span>
            <div class="active-filters-list" id="active-filters-list"></div>
        </div>
    </div>

    {% if produtos %}
        <div class="products-grid" id="products-grid">
            <!-- Atualize a se√ß√£o do produto no index.html -->
            {% for produto in produtos %}
                <div class="product-card" data-id="{{ produto.id }}" data-imagem="{{ produto.imagem or '' }}" data-preco="{{ produto.preco }}" data-nome="{{ produto.nome|e }}" data-descricao="{{ (produto.descricao or '')|e }}">
                  <div class="product-image">
                    <img src="{{ produto.imagem or 'https://via.placeholder.com/800x800/f0f0f0/666?text=Sem+Imagem' }}" alt="{{ produto.nome }}">
                    <button class="qv-trigger"><i class="fas fa-eye"></i> Visualiza√ß√£o r√°pida</button>
                  </div>
                  
                  <div class="product-info">
                      <h3 class="product-name">{{ produto.nome }}</h3>
                      {% if produto.categoria %}
                          <span class="product-category">{{ produto.categoria }}</span>
                      {% endif %}
                      <div class="product-price">{{ produto.preco|currency }}</div>
                      
                      {% if session.user_id %}
                          <button onclick="addToCart({{ produto.id }}, '{{ produto.nome }}')" class="btn-add-cart">
                              <i class="fas fa-shopping-bag"></i> Adicionar ao Carrinho
                          </button>
                      {% else %}
                          <a href="{{ url_for('login') }}" class="btn-add-cart">
                              <i class="fas fa-sign-in-alt"></i> Fazer Login para Comprar
                          </a>
                      {% endif %}
                  </div>
                </div>
            {% endfor %}
        </div>

        <!-- Mensagem quando n√£o h√° produtos filtrados -->
        <div class="no-products-message" id="no-products" style="display: none;">
            <div style="text-align: center; padding: 80px 20px; color: #666;">
                <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                <h3>Nenhum produto encontrado</h3>
                <p>Tente ajustar os filtros ou buscar por outros termos</p>
                <button onclick="clearAllFilters()" class="btn-clear-filters" style="margin-top: 20px;">
                    üîÑ Limpar todos os filtros
                </button>
            </div>
        </div>
    {% else %}
        <div style="text-align: center; padding: 80px 20px; color: #666;">
            <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
            <h3>Nenhum produto cadastrado</h3>
            <p>Em breve novos produtos incr√≠veis!</p>
        </div>
    {% endif %}
</section>

<!-- Modal de Visualiza√ß√£o R√°pida -->
<div class="quick-view-modal" id="quick-view-modal">
    <div class="modal-overlay" onclick="closeQuickView()"></div>
    <div class="modal-content">
        <button class="modal-close" onclick="closeQuickView()">
            <i class="fas fa-times"></i>
        </button>
        
        <div class="modal-body">
            <div class="product-image-section">
                <img id="modal-product-image" src="" alt="" class="modal-product-img">
            </div>
            
            <div class="product-details-section">
                <div class="product-header">
                    <span id="modal-product-category" class="modal-category"></span>
                    <h2 id="modal-product-name" class="modal-title"></h2>
                    <div id="modal-product-price" class="modal-price"></div>
                </div>
                
                <div class="product-description">
                    <h3>Descri√ß√£o</h3>
                    <p id="modal-product-description">Produto de alta qualidade com excelente acabamento e conforto.</p>
                </div>
                
                <div class="product-sizes">
                    <h3>Tamanhos dispon√≠veis</h3>
                    <div class="size-selector">
                        <button class="size-btn" onclick="selectSize('PP')">PP</button>
                        <button class="size-btn" onclick="selectSize('P')">P</button>
                        <button class="size-btn active" onclick="selectSize('M')">M</button>
                        <button class="size-btn" onclick="selectSize('G')">G</button>
                        <button class="size-btn" onclick="selectSize('GG')">GG</button>
                        <button class="size-btn" onclick="selectSize('XG')">XG</button>
                    </div>
                </div>
                
                <div class="product-actions">
                    {% if session.user_id %}
                        <button id="modal-add-cart" class="btn-modal-cart" onclick="addToCartFromModal()">
                            <i class="fas fa-shopping-bag"></i> Adicionar ao Carrinho
                        </button>
                        <button class="btn-modal-wishlist" onclick="addToWishlist()">
                            <i class="fas fa-heart"></i> Favoritar
                        </button>
                    {% else %}
                        <a href="{{ url_for('login') }}" class="btn-modal-cart">
                            <i class="fas fa-sign-in-alt"></i> Fazer Login para Comprar
                        </a>
                    {% endif %}
                </div>
                
                <div class="product-info">
                    <div class="info-item">
                        <i class="fas fa-truck"></i>
                        <span>Frete gr√°tis para compras acima de R$ 150</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>Compra 100% segura e garantida</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-redo-alt"></i>
                        <span>Troca gr√°tis em at√© 30 dias</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick View Modal - Novo Estilo -->
<div id="qv-modal" class="qv-modal" aria-hidden="true">
  <div class="qv-backdrop" onclick="closeQuickView()"></div>
  <div class="qv-dialog" role="dialog" aria-modal="true">
    <button class="qv-close" onclick="closeQuickView()"><i class="fas fa-times"></i></button>

    <div class="qv-content">
      <!-- Galeria esquerda -->
      <div class="qv-gallery">
        <div id="qv-thumbs" class="qv-thumbs"></div>
      </div>

      <!-- Imagem grande -->
      <div class="qv-main">
        <img id="qv-main-img" src="" alt="Produto" onerror="this.src='https://via.placeholder.com/900x900/f0f0f0/666?text=Sem+Imagem'">
      </div>

      <!-- Detalhes √† direita -->
      <div class="qv-side">
        <h2 id="qv-title" class="qv-title">Nome do Produto</h2>

        <div class="qv-prices">
          <span id="qv-old" class="qv-old">R$ 0,00</span>
          <span id="qv-price" class="qv-price">R$ 0,00</span>
        </div>

        <div class="qv-qty-row">
          <div class="qv-qty">
            <button type="button" class="qty-btn" onclick="decQty()">‚àí</button>
            <input id="qv-qty" type="number" min="1" max="99" value="1" inputmode="numeric">
            <button type="button" class="qty-btn" onclick="incQty()">+</button>
          </div>

          {% if session.user_id %}
          <button id="qv-buy" class="qv-buy"><i class="fas fa-shopping-bag"></i> Comprar</button>
          {% else %}
          <a class="qv-buy" href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> Fazer login</a>
          {% endif %}
        </div>

        <button id="qv-fav" class="qv-fav"><i class="far fa-heart"></i> Salvar como favorito</button>

        <div class="qv-share">
          <span>Compartilhar:</span>
          <a id="share-fb" target="_blank" rel="noopener" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
          <a id="share-tw" target="_blank" rel="noopener" aria-label="Twitter"><i class="fab fa-x-twitter"></i></a>
          <a id="share-wa" target="_blank" rel="noopener" aria-label="WhatsApp"><i class="fab fa-whatsapp"></i></a>
          <button id="share-copy" class="share-copy" onclick="copyShare()"><i class="fas fa-link"></i></button>
        </div>

        <p id="qv-desc" class="qv-desc"></p>
      </div>
    </div>
  </div>
</div>

<style>
/* Estilos para o sistema de filtros */
.filters-panel {
    position: fixed;
    top: 0;
    right: -400px;
    width: 400px;
    height: 100vh;
    background: white;
    box-shadow: -5px 0 20px rgba(0,0,0,0.1);
    z-index: 2000;
    transition: right 0.3s ease;
    overflow-y: auto;
}

.filters-panel.active {
    right: 0;
}

.filters-container {
    padding: 0;
    height: 100%;
    display: flex;
    flex-direction: column;
}

.filters-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 25px;
    border-bottom: 1px solid var(--border-light);
    background: var(--secondary-color);
}

.filters-header h3 {
    margin: 0;
    color: var(--text-primary);
    font-size: 1.2rem;
}

.close-filters {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 8px;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.close-filters:hover {
    background: var(--border-light);
    color: var(--text-primary);
}

.filters-content {
    flex: 1;
    padding: 25px;
}

.filter-group {
    margin-bottom: 30px;
}

.filter-group h4 {
    margin-bottom: 15px;
    color: var(--text-primary);
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.filter-options {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.filter-option {
    display: flex;
    align-items: center;
    cursor: pointer;
    padding: 8px 0;
    transition: all 0.3s ease;
}

.filter-option:hover {
    color: var(--accent-color);
}

.filter-option input[type="checkbox"] {
    display: none;
}

.checkmark {
    width: 18px;
    height: 18px;
    border: 2px solid var(--border-light);
    border-radius: 4px;
    margin-right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.filter-option input[type="checkbox"]:checked + .checkmark {
    background: var(--accent-color);
    border-color: var(--accent-color);
}

.filter-option input[type="checkbox"]:checked + .checkmark::after {
    content: "‚úì";
    color: white;
    font-size: 12px;
    font-weight: bold;
}

.price-range {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.price-inputs {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.price-inputs div {
    display: flex;
    flex-direction: column;
}

.price-inputs label {
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 5px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.price-inputs input {
    padding: 8px 12px;
    border: 1px solid var(--border-light);
    border-radius: 6px;
    font-size: 14px;
}

.size-options {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-top: 10px;
}

.size-option {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.size-option input[type="checkbox"] {
    display: none;
}

.size-checkmark {
    width: 40px;
    height: 40px;
    border: 2px solid var(--border-light);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
    background: white;
    color: var(--text-secondary);
}

.size-option:hover .size-checkmark {
    border-color: var(--accent-color);
    color: var(--accent-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.size-option input[type="checkbox"]:checked + .size-checkmark {
    background: var(--accent-color);
    border-color: var(--accent-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
}

/* Estilo especial para "Todos" */
.size-option:first-child .size-checkmark {
    font-size: 10px;
    padding: 0 4px;
}

/* Mobile responsivo para tamanhos */
@media (max-width: 768px) {
    .size-options {
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
    }
    
    .size-checkmark {
        width: 35px;
        height: 35px;
        font-size: 11px;
    }
}

.quick-filters {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.quick-filter {
    background: var(--secondary-color);
    border: 1px solid var(--border-light);
    padding: 10px 15px;
    text-align: left;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-size: 14px;
}

.quick-filter:hover, .quick-filter.active {
    background: var(--accent-color);
    color: white;
    border-color: var(--accent-color);
}

.filter-actions {
    display: flex;
    gap: 10px;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-light);
}

.btn-clear-filters, .btn-apply-filters {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.btn-clear-filters {
    background: white;
    color: var(--text-secondary);
    border: 1px solid var(--border-light);
}

.btn-clear-filters:hover {
    background: var(--secondary-color);
}

.btn-apply-filters {
    background: var(--primary-color);
    color: white;
    border: 1px solid var(--primary-color);
}

.btn-apply-filters:hover {
    background: var(--accent-color);
    border-color: var(--accent-color);
}

.active-filters {
    background: var(--secondary-color);
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid var(--accent-color);
}

.active-filters-label {
    font-size: 12px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    margin-right: 10px;
}

.active-filters-list {
    display: inline-flex;
    flex-wrap: wrap;
    gap: 8px;
}

.active-filter-tag {
    background: var(--accent-color);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.active-filter-tag .remove {
    cursor: pointer;
    font-weight: bold;
}

/* Melhorar estilos das imagens dos produtos */
.product-image {
    height: 400px;
    background: var(--secondary-color);
    overflow: hidden;
    position: relative;
    border-radius: 12px 12px 0 0;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    display: block;
}

.product-card:hover .product-image img {
    transform: scale(1.08);
}

.product-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #ccc;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
}

.product-placeholder i {
    font-size: 3rem;
    margin-bottom: 10px;
    opacity: 0.5;
}

.product-placeholder p {
    font-size: 14px;
    margin: 0;
    opacity: 0.7;
}

/* Melhorar o loading das imagens */
.product-image img[src=""], 
.product-image img:not([src]) {
    display: none;
}

.product-image img {
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.product-image img.loaded {
    opacity: 1;
}

/* Overlay para fechar filtros */
.filters-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.filters-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* Modal de Visualiza√ß√£o R√°pida */
.quick-view-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 3000;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.quick-view-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
}

.modal-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(5px);
}

.modal-content {
    position: relative;
    background: white;
    border-radius: 16px;
    max-width: 900px;
    width: 90%;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.modal-close:hover {
    background: var(--accent-color);
    color: white;
    transform: rotate(90deg);
}

.modal-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    height: 70vh;
    overflow: hidden;
}

.product-image-section {
    background: var(--secondary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 40px;
}

.modal-product-img {
    width: 100%;
    height: 100%;
    max-height: 500px;
    object-fit: cover;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.product-details-section {
    padding: 40px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.modal-category {
    font-size: 12px;
    color: var(--accent-color);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
}

.modal-title {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    color: var(--text-primary);
    margin: 5px 0 15px 0;
    line-height: 1.2;
}

.modal-price {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary-color);
    font-family: 'Playfair Display', serif;
}

.product-description h3,
.product-sizes h3 {
    font-size: 16px;
    color: var(--text-primary);
    margin-bottom: 10px;
    font-weight: 600;
}

.product-description p {
    color: var(--text-secondary);
    line-height: 1.6;
    font-size: 14px;
}

.size-selector {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.size-btn {
    width: 45px;
    height: 45px;
    border: 2px solid var(--border-light);
    background: white;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.size-btn:hover {
    border-color: var(--accent-color);
    transform: translateY(-2px);
}

.size-btn.active {
    background: var(--accent-color);
    border-color: var(--accent-color);
    color: white;
}

.product-actions {
    display: flex;
    gap: 15px;
    margin: 20px 0;
}

.btn-modal-cart,
.btn-modal-wishlist {
    flex: 1;
    padding: 15px 20px;
    border: none;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    text-decoration: none;
}

.btn-modal-cart {
    background: var(--primary-color);
    color: white;
}

.btn-modal-cart:hover {
    background: var(--accent-color);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

.btn-modal-wishlist {
    background: white;
    color: var(--text-secondary);
    border: 1px solid var(--border-light);
}

.btn-modal-wishlist:hover {
    background: #ff4757;
    color: white;
    border-color: #ff4757;
}

.product-info {
    border-top: 1px solid var(--border-light);
    padding-top: 20px;
}

.info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-size: 13px;
    color: var(--text-secondary);
}

.info-item i {
    color: var(--accent-color);
    width: 16px;
}

/* Grid simples */
.products-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(240px,1fr)); gap: 20px; }
.product-image { position: relative; height: 320px; border-radius: 12px; overflow: hidden; background: #f3f4f6; }
.product-image img { width: 100%; height: 100%; object-fit: cover; transition: transform .5s ease; }
.product-card:hover .product-image img { transform: scale(1.06); }
.qv-trigger { position: absolute; inset: 0; margin: auto; height: 44px; width: 70%; max-width: 260px;
  display: flex; align-items: center; justify-content: center; gap: 8px;
  background: rgba(0,0,0,.85); color: #fff; border: none; border-radius: 8px; opacity: 0; transform: translateY(12px);
  transition: all .3s; cursor: pointer; }
.product-image:hover .qv-trigger { opacity: 1; transform: translateY(0); }
.qv-trigger:hover { background: #111; }

/* Modal */
.qv-modal { position: fixed; inset: 0; display: none; z-index: 3000; }
.qv-modal.show { display: block; }
.qv-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.7); backdrop-filter: blur(3px); }
.qv-dialog { position: relative; margin: 40px auto; max-width: 1100px; background: #fff; border-radius: 16px; overflow: hidden; box-shadow: 0 25px 70px rgba(0,0,0,.35); }
.qv-close { position: absolute; right: 14px; top: 12px; background: #fff; border: 1px solid #eee; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; }
.qv-close:hover { background: #000; color: #fff; }

.qv-content { display: grid; grid-template-columns: 120px 1fr 420px; gap: 24px; padding: 28px; }
.qv-gallery { padding-top: 8px; }
.qv-thumbs { display: flex; flex-direction: column; gap: 10px; max-height: 540px; overflow: auto; }
.qv-thumb { width: 100%; aspect-ratio: 1/1; border-radius: 8px; overflow: hidden; border: 2px solid transparent; cursor: pointer; background: #f3f4f6; }
.qv-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
.qv-thumb.active { border-color: #111; }

.qv-main { display: flex; align-items: center; justify-content: center; background: #fafafa; border-radius: 12px; min-height: 540px; }
.qv-main img { width: 100%; height: 100%; max-height: 620px; object-fit: contain; }

.qv-side { display: flex; flex-direction: column; gap: 18px; }
.qv-title { font-size: 28px; line-height: 1.2; margin: 0; }
.qv-prices { display: flex; align-items: baseline; gap: 14px; }
.qv-old { color: #a1a1a1; text-decoration: line-through; }
.qv-price { font-size: 28px; font-weight: 700; }

.qv-qty-row { display: flex; gap: 12px; align-items: center; }
.qv-qty { display: inline-flex; align-items: center; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; }
.qv-qty input { width: 60px; text-align: center; border: 0; padding: 10px 6px; outline: none; }
.qty-btn { width: 40px; height: 40px; border: 0; background: #f3f4f6; cursor: pointer; font-size: 18px; }
.qty-btn:hover { background: #e5e7eb; }

.qv-buy { flex: 1; display: inline-flex; align-items: center; justify-content: center; gap: 10px;
  background: #1a1a1a; color: #fff; border: 0; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; text-decoration: none; }
.qv-buy:hover { background: #000; }
.qv-fav { background: transparent; border: 0; color: #111; text-align: left; display: inline-flex; gap: 8px; align-items: center; cursor: pointer; }
.qv-fav.active { color: #e74c3c; }

.qv-share { display: flex; align-items: center; gap: 12px; color: #6b7280; }
.qv-share a, .share-copy { width: 36px; height: 36px; border-radius: 50%; border: 1px solid #e5e7eb; display: inline-flex; align-items: center; justify-content: center; color: #111; background: #fff; }
.qv-share a:hover, .share-copy:hover { background: #111; color: #fff; }

.qv-desc { color: #6b7280; line-height: 1.6; }

/* Responsivo */
@media (max-width: 1024px){
  .qv-content{ grid-template-columns: 100px 1fr 360px; }
}
@media (max-width: 860px){
  .qv-dialog{ margin: 10px; }
  .qv-content{ grid-template-columns: 1fr; }
  .qv-gallery{ order: 2; }
  .qv-main{ order: 1; min-height: 320px; }
  .qv-side{ order: 3; }
}
</style>

<script>
let QV = { id:null, imgs:[], idx:0 };

function openQuickView(id){
  const card = document.querySelector(`.product-card[data-id="${id}"]`);
  if(!card) return;

  QV.id = id;
  const nome = card.dataset.nome;
  const preco = parseFloat(card.dataset.preco || '0');
  const imagem = card.dataset.imagem || '';
  const desc = card.dataset.descricao || '';

  // imagens (se no futuro tiver JSON de galeria, pode preencher aqui)
  QV.imgs = (imagem ? [imagem] : ['https://via.placeholder.com/900x900/f0f0f0/666?text=Sem+Imagem']);
  QV.idx = 0;

  document.getElementById('qv-title').textContent = nome;
  document.getElementById('qv-price').textContent = formatBRL(preco);
  document.getElementById('qv-old').textContent = formatBRL(Math.max(preco * 1.25, preco)); // "de"
  document.getElementById('qv-desc').textContent = desc;
  document.getElementById('qv-qty').value = 1;

  // monta thumbs
  const thumbs = document.getElementById('qv-thumbs');
  thumbs.innerHTML = '';
  QV.imgs.forEach((src, i)=>{
    const d = document.createElement('div');
    d.className = 'qv-thumb' + (i===0?' active':'');
    d.onclick = ()=>setMain(i);
    d.innerHTML = `<img src="${src}" alt="thumb">`;
    thumbs.appendChild(d);
  });

  // imagem principal
  setMain(0);

  // compartilhar
  const shareUrl = window.location.origin + '/?p=' + id;
  document.getElementById('share-fb').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
  document.getElementById('share-tw').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(nome)}`;
  document.getElementById('share-wa').href = `https://wa.me/?text=${encodeURIComponent(nome+' - '+shareUrl)}`;

  // comprar
  const buy = document.getElementById('qv-buy');
  if (buy && buy.tagName === 'BUTTON') {
    buy.onclick = ()=>{
      const q = clamp(parseInt(document.getElementById('qv-qty').value||'1',10),1,99);
      window.location.href = `/carrinho/adicionar/${id}?q=${q}`;
    };
  }

  // favorito
  const fav = document.getElementById('qv-fav');
  fav.classList.remove('active');
  fav.onclick = ()=>{
    fav.classList.toggle('active');
  };

  // abrir
  document.getElementById('qv-modal').classList.add('show');
  document.body.style.overflow = 'hidden';
}

function closeQuickView(){
  document.getElementById('qv-modal').classList.remove('show');
  document.body.style.overflow = '';
}

function setMain(i){
  QV.idx = i;
  const img = document.getElementById('qv-main-img');
  img.style.opacity = .6;
  img.onload = ()=>img.style.opacity = 1;
  img.src = QV.imgs[i];

  // ativa thumb
  document.querySelectorAll('.qv-thumb').forEach((t,idx)=>t.classList.toggle('active', idx===i));
}

function incQty(){ const el = document.getElementById('qv-qty'); el.value = clamp(parseInt(el.value||'1',10)+1,1,99); }
function decQty(){ const el = document.getElementById('qv-qty'); el.value = clamp(parseInt(el.value||'1',10)-1,1,99); }

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function formatBRL(v){ return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(v); }

document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeQuickView(); });

// Torna acess√≠vel aos handlers inline
window.openQuickView = openQuickView;
window.closeQuickView = closeQuickView;

// Delega√ß√£o de clique (funciona mesmo se o onclick inline n√£o rodar)
document.addEventListener('click', function(e){
  const btn = e.target.closest('.qv-trigger');
  if (!btn) return;
  const card = btn.closest('.product-card');
  if (card) openQuickView(card.dataset.id);
});

// Defensivo: avisa se o modal n√£o est√° no DOM
const _open = openQuickView;
function openQuickView(id){
  const modal = document.getElementById('qv-modal');
  if (!modal) {
    console.warn('Modal de Visualiza√ß√£o R√°pida n√£o encontrado (id="qv-modal").');
    return;
  }
  return _open(id); // chama a implementa√ß√£o original
}
</script>
{% endblock %}
